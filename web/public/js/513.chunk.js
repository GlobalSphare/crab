"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[513],{7513:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(8390),r=n(7294),l=n(4494),i=n(282),c=n(9669),o=n.n(c),s=n(3411),p=n(5347);function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var u=['name: example\ntype: webservice\nvendor: webservice\nproperties:\n    image: nginx:1.21\ntraits:\n    - type: expose\n      properties:\n        k1: "v1"'];const d=(0,l.$j)((function(e){return e}))((function(e){var t=(0,r.useRef)(null),n=(0,r.useState)('apiVersion: aam.globalsphare.com/v1alpha1\nkind: Application\nmetadata:\n  name: example\n  version: 0.0.1\n  description: 样例应用\n  keywords:\n    - 样例应用\n  author: example@example.com\n  maintainers:\n    - email: example@example.com\n      name: example\n      web: https://example.com\n  repositories: ["https://github.com/example/example.git"]\n  bugs: https://github.com/example/example/issues\n  licenses:\n    - type: LGPL\n      url: https://license.spec.com'),l=(0,a.Z)(n,2),c=l[0],d=l[1],f=(0,r.useState)('"$schema": http://json-schema.org/draft-07/schema#\n"$id": http://example.com/product.schema.json\ntitle: User\ndescription: init user description\ntype: object\nproperties:\n  username:\n    type: string\n  password:\n    type: string\nrequired:\n  - username\n  - password'),v=(0,a.Z)(f,2),h=v[0],y=v[1],g=(0,r.useState)(u),x=(0,a.Z)(g,2),E=x[0],b=x[1],N=(0,r.useState)('- name: gitlab\nversion: ">=0.0.1"\nlocation: user-defined(https://gitlab.com)\nitems:\n  /*:\n    - create\n    - read\n    - update\n    - delete'),w=(0,a.Z)(N,2),S=w[0],Z=w[1],k=(0,r.useState)("/user:\n  - create\n  - read\n  - update\n  - delete\n/admin:\n  - create\n  - read\n  - update\n  - delete"),C=(0,a.Z)(k,2),j=C[0],T=C[1],A="",O=function(e){var t=e.currentTarget.dataset.index,n=E.slice();n[t]=e.target.value,b(n)},$=function(e){var t=e.currentTarget.dataset.index,n=E.slice();n.splice(t,1),b(n)};function _(){var e=/\n/g;A=c+"\nuserconfig:\n  "+h.replace(e,"\n  ")+"\nworkloads:\n  "+E.map((function(t){return t.replace(e,"\n  ")})).join("\n  ")+"\ndependecies:\n  "+S.replace(e,"\n  ")+"\nexports:\n  "+j.replace(e,"\n  "),t.current.innerText=A}function q(){var e=document.querySelector(".createapp-left").offsetHeight;document.querySelector(".preview-pre").style.height=e-50+"px"}(0,r.useEffect)((function(){_(),q()}),[c,h,E,S,j]),(0,r.useEffect)((function(){_(),q()}),[]);var I=function(){if(""===c.trim())return s.Z.dispatch({type:p.Sn,val:"metadata不能为空"}),!1;if(1===E.length&&""===E[0].trim())return s.Z.dispatch({type:p.Sn,val:"workloads不能为空"}),!1;if(E.length>1){var e,t=!0,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,l=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw l}}}}(E);try{for(n.s();!(e=n.n()).done;)if(""!==e.value.trim()){t=!1;break}}catch(e){n.e(e)}finally{n.f()}return t&&s.Z.dispatch({type:p.Sn,val:"workloads不能为空"}),!t}return!0};return r.createElement("section",{className:"page-container online-container"},r.createElement("div",{className:"page-title"},"创建应用"),r.createElement("section",{className:"createapp-content"},r.createElement("div",{className:"createapp-left"},r.createElement("div",{className:"online-title"},r.createElement("p",null,"metadata",r.createElement("span",null,"*"))),r.createElement("div",{className:"online-textarea"},r.createElement("textarea",{className:"textarea-input",value:c,onChange:function(e){d(e.target.value)}})),r.createElement("div",{className:"online-title"},r.createElement("p",null,"userconfig")),r.createElement("div",{className:"online-textarea"},r.createElement("textarea",{className:"textarea-input",value:h,onChange:function(e){y(e.target.value)}})),r.createElement("div",{className:"online-title"},r.createElement("p",null,"workloads",r.createElement("span",null,"*"))),E&&E.length?E.map((function(e,t){return r.createElement("div",{className:"online-textarea vartextarea",key:t},r.createElement("textarea",{className:"textarea-input",value:e,"data-index":t,onChange:O}),E.length>1?r.createElement(i.Z,{className:"createapp-removebtn",variant:"contained",color:"secondary","data-index":t,onClick:$},"移除"):null)})):null,r.createElement("div",{className:"createapp-addbtn"},r.createElement(i.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=E.slice();e.push(""),b(e)}},"添加")),r.createElement("div",{className:"online-title"},r.createElement("p",null,"dependencies")),r.createElement("div",{className:"online-textarea"},r.createElement("textarea",{className:"textarea-input",value:S,onChange:function(e){Z(e.target.value)}})),r.createElement("div",{className:"online-title"},r.createElement("p",null,"exports")),r.createElement("div",{className:"online-textarea"},r.createElement("textarea",{className:"textarea-input",value:j,onChange:function(e){T(e.target.value)}}))),r.createElement("div",{className:"createapp-right"},r.createElement("div",{className:"online-title"},r.createElement("p",null,"预览")),r.createElement("div",{className:"createapp-preview"},r.createElement("pre",{className:"preview-pre",ref:t})))),r.createElement("section",{className:"online-btns"},r.createElement(i.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){I()&&(s.Z.dispatch({type:p.br,val:!0}),o()({method:"POST",url:"/api/online/download",data:{yaml:A},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?window.open(window.location.origin+e.data.result):s.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:p.br,val:!1})})))}},"下载"),r.createElement(i.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){I()&&(s.Z.dispatch({type:p.br,val:!0}),o()({method:"POST",url:"/api/online/arrange",data:{yaml:A},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?s.Z.dispatch({type:p.Sn,val:"部署成功"}):s.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:p.br,val:!1})})))}},"部署")))}))}}]);