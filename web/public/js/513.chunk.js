"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[513],{2225:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(8390),i=n(7294),c=n(8623),s=n(4313),l=n(9525),r=n(6856),o=n(282);const p=function(e){var t=(0,i.useState)(!1),n=(0,a.Z)(t,2),p=n[0],u=n[1],d=(0,i.useState)([]),m=(0,a.Z)(d,2),f=m[0],h=m[1],v=(0,i.useState)(),y=(0,a.Z)(v,2),g=y[0],b=y[1];(0,i.useEffect)((function(){N(e.data)}),[e.data]);var E,x,k,Z,N=function(e){if(e&&e.dependencies&&(Object.keys(e.dependencies).forEach((function(t){var n=[];e.dependencies[t].instances.forEach((function(a,i){0==i&&"mutable"===e.dependencies[t].type?n.push({instance:a,selected:!0}):n.push({instance:a,selected:!1})})),e.dependencies[t].instances&&e.dependencies[t].instances.length&&"immutable"!==e.dependencies[t].type?e.dependencies[t].location={location:e.dependencies[t].location,selected:!1}:e.dependencies[t].location={location:e.dependencies[t].location,selected:!0},e.dependencies[t].instances=n})),console.log("data===",e),b(e),e.userconfigs&&Object.keys(e.userconfigs).length)){var t=[];!function e(n,a,i,c){n&&("object"==n.type&&n.properties?("userconfigs"!==a&&t.push({key:a,type:n.type,val:"",required:!1,error:"",level:c}),c+=1,Object.keys(n.properties).forEach((function(t){e(n.properties[t],t,n.required,c)}))):t.push({key:a,type:n.type,val:"",required:!!i&&-1!==i.indexOf(a),error:"",level:c}))}(e.userconfigs,"userconfigs",!1,-1),u(!0),h(t)}};function C(){e.close()}function S(e,t,n){if("immutable"!==g.dependencies[t].type||"instance"!=e){var a=Object.assign({},g);"instance"===e?(a.dependencies[t].location.selected=!1,a.dependencies[t].instances.forEach((function(e,t){t==n?(e.selected=!e.selected,e.selected):e.selected=!1}))):"location"===e&&(a.dependencies[t].instances.forEach((function(e,t){e.selected=!1})),a.dependencies[t].location.selected=!a.dependencies[t].location.selected,a.dependencies[t].location.selected),b(a)}}function w(){var e=event.target.dataset.key,t=Object.assign({},g);t.dependencies[e].location.location=event.target.value,b(t)}function j(){var e=event.target.dataset.index,t=f.slice();t[e].val=event.target.value,t[e].error="",h(t)}return i.createElement(c.Z,{open:e.open,onClose:C,"aria-labelledby":"upload-file-title"},i.createElement(s.Z,{id:"upload-file-title"},e.title),i.createElement(l.Z,null,i.createElement("div",{className:"instance-content"},(E=e.data,k=[],Z=-34,(x=E.dependencies||null)&&(Z+=34,Object.keys(x).forEach((function(e,t){k.push(i.createElement("div",{style:{paddingLeft:Z+"px"},className:"app-item",key:t},i.createElement("div",{className:"app-label"},i.createElement("span",{style:{backgroundColor:"#54CACB"},className:"label-icon app-icon"},i.createElement("i",{className:"iconfont icon_grey600"})," "),i.createElement("span",{className:"label-name"},e)),(x[e].instances||[]).map((function(t,n){return i.createElement("div",{key:n,className:"app-item-versions"},i.createElement("div",{className:"app-label",key:n},i.createElement("span",{className:"label-icon version-icon",onClick:function(){S("instance",e,n)}},i.createElement("i",{style:{color:"mutable"===x[e].type?"#54CACB":"#e0e0e0"},className:"".concat(t.selected?"iconfont icon_d-pass":"")})),i.createElement("span",{className:"label-name",style:{color:"mutable"===x[e].type?"#262626":"gray"}},"实例：",t.instance&&t.instance.id?t.instance.id:"","  ",t.instance&&t.instance.name?t.instance.name:"")))})),x[e].location?i.createElement("div",{className:"app-item-versions"},i.createElement("div",{className:"app-label"},i.createElement("span",{className:"label-icon version-icon",onClick:function(){S("location",e,"")}},i.createElement("i",{style:{color:"mutable"===x[e].type?"#54CACB":"#e0e0e0"},className:"".concat(x[e].location.selected?"iconfont icon_d-pass":"")})),i.createElement("span",{className:"label-name",style:{color:"mutable"===x[e].type?"#262626":"gray"}},"服务地址：",i.createElement("input",{"data-key":e,onChange:w,value:x[e].location.location,disabled:"immutable"===x[e].type,style:{color:"mutable"===x[e].type?"#262626":"gray"}})))):null,x[e].instances.length||x[e].location?null:i.createElement("div",{className:"app-item-versions"},i.createElement("div",{className:"app-label"},i.createElement("span",{className:"label-icon version-icon"}),i.createElement("span",{className:"label-name"},"暂无，需创建")))))}))),k).map((function(e,t){return e}))),i.createElement(c.Z,{open:p,"aria-labelledby":"config-title"},i.createElement(s.Z,{id:"config-title"},"实例配置"),i.createElement(l.Z,null,i.createElement("div",{className:"appconfig-content"},f.map((function(e,t){return"object"===e.type?i.createElement("div",{key:e.key,className:"config-item",style:{marginLeft:40*e.level+"px"}},i.createElement("div",{className:"item-input"},i.createElement("label",null,e.key,":"))):i.createElement("div",{key:e.key,className:"config-item",style:{marginLeft:40*e.level+"px"}},i.createElement("div",{className:"item-input"},i.createElement("label",null,e.required?i.createElement("span",null,"* "):null,e.key,":"),i.createElement("input",{type:"number"==e.type?"number":"text",className:e.error?"red-border":"",placeholder:"number"===e.type?"请输入number类型":"请输入string类型","data-index":t,onChange:j,value:e.val})),e.error?i.createElement("p",{className:"item-error"},e.error):null)})))),i.createElement(r.Z,null,i.createElement(o.Z,{className:"common-btn",color:"primary",onClick:function(){var e=!0,t=f.slice();if(t.forEach((function(t){"object"!==t.type&&t.required&&""==t.val.trim()&&(t.error="请输入",e=!1)})),e){var n=Object.assign({},g);!function e(t,n){if(t)if("object"==t.type&&t.properties)Object.keys(t.properties).forEach((function(n){e(t.properties[n],n)}));else{console.log(222);var a=f.findIndex((function(e){return e.key===n}));t.val="number"===f[a].type?Number(f[a].val):f[a].val}}(n.userconfigs,"userconfigs"),console.log("--newAppInfo--",n),b(n),u(!1)}else h(t)}},"确定")))),i.createElement(r.Z,null,i.createElement(o.Z,{className:"common-btn",onClick:C},"取消"),i.createElement(o.Z,{className:"common-btn",color:"primary",onClick:function(){var t,n,a,i;e.submit((t=function(e){var t,n=[];return t=e,Object.keys(t).length&&Object.keys(t).forEach((function(e){var a=!1;t[e].location.selected?a=!0:t[e].instances.forEach((function(e){e.selected&&(a=!0)})),a||n.push(e)})),n}(g.dependencies||{}),console.log("--getData-0",g),{appInfo:g,notHadServe:(n=g.dependencies||[],i=[],a=n,Object.keys(a).length&&Object.keys(a).forEach((function(e){a[e].instances.length||a[e].location||i.push(e)})),i||[]),allAppSelectServe:t}))}},"确定")))}},6381:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(5671),i=n(3144),c=n(7326),s=n(9611),l=n(1002);function r(e,t){return!t||"object"!==(0,l.Z)(t)&&"function"!=typeof t?(0,c.Z)(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=n(7294);var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,s.Z)(e,t)}(u,e);var t,n,l=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=o(t);if(n){var i=o(this).constructor;e=Reflect.construct(a,arguments,i)}else e=a.apply(this,arguments);return r(this,e)});function u(e){var t;return(0,a.Z)(this,u),(t=l.call(this,e)).state={value:""},t.txaRef=p.createRef(),t.setData=t.setData.bind((0,c.Z)(t)),t.getData=t.getData.bind((0,c.Z)(t)),t.lineHeight=0,t.padding=0,t.pasteData=!1,t.ctrlKey=!1,t}return(0,i.Z)(u,[{key:"componentDidMount",value:function(){this.lineHeight=parseInt(getComputedStyle(this.txaRef.current).lineHeight),this.padding=2*parseInt(getComputedStyle(this.txaRef.current).paddingTop),this.txaRef.current.style.height=this.padding+this.lineHeight+"px"}},{key:"setData",value:function(e){var t=this;this.setState({value:e},(function(){""===t.state.value.trim()?t.txaRef.current.style.height=t.padding+t.lineHeight+"px":t.txaRef.current.style.height=t.txaRef.current.scrollHeight+"px"}))}},{key:"getData",value:function(){return this.state.value}},{key:"changeValue",value:function(e){this.setState({value:e.target.value})}},{key:"keyDown",value:function(e){var t=this;if(13===e.keyCode)this.txaRef.current.style.height=this.txaRef.current.offsetHeight+this.lineHeight+"px";else if(9===e.keyCode){e.preventDefault();var n=this.txaRef.current.selectionStart,a=this.state.value.substring(0,n)+"    "+this.state.value.substring(n);this.setState({value:a},(function(){t.txaRef.current.selectionStart=n+4,t.txaRef.current.selectionEnd=n+4}))}else 91!=e.keyCode&&17!==e.keyCode||(this.ctrlKey=!0)}},{key:"keyUp",value:function(e){if(8===e.keyCode){var t=e.target.value.split("\n").length*this.lineHeight;t+this.padding<this.txaRef.current.offsetHeight&&(this.txaRef.current.style.height=t+"px")}else if(13===e.keyCode){var n=e.target.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=n+"px"}else if(9===e.keyCode)e.preventDefault();else if(88===e.keyCode&&this.ctrlKey){var a=e.target.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=a+"px",this.ctrlKey=!1}}},{key:"autoTxaClick",value:function(){this.txaRef.current.focus()}},{key:"paste",value:function(){this.pasteData=!0}},{key:"componentDidUpdate",value:function(){if(this.pasteData){var e=this.txaRef.current.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=e+"px",this.pasteData=!1}}},{key:"render",value:function(){return p.createElement("div",{className:"auto-textarea ".concat(this.props.class),onClick:this.autoTxaClick.bind(this)},p.createElement("textarea",{ref:this.txaRef,className:"auto-input",placeholder:"请输入...",value:this.state.value,onChange:this.changeValue.bind(this),onKeyDown:this.keyDown.bind(this),onKeyUp:this.keyUp.bind(this),onPaste:this.paste.bind(this)}))}}]),u}(p.Component)},7513:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a=n(8390),i=n(7294),c=n(4494),s=n(282),l=n(9669),r=n.n(l),o=n(3411),p=n(5347),u=n(2225),d=n(9678),m=n(6105),f=n(6381),h="apiVersion: aam.globalsphare.com/v1alpha1\nkind: Application\nmetadata:";const v=(0,c.$j)((function(e){return e}))((function(e){var t=(0,i.useState)(!1),n=(0,a.Z)(t,2),c=n[0],l=n[1],v=(0,i.useState)({}),y=(0,a.Z)(v,2),g=y[0],b=y[1],E=(0,i.useRef)(null),x=(0,i.useRef)(null),k=(0,i.useRef)(null),Z=(0,i.useRef)(null),N=(0,i.useRef)(null),C=(0,i.useRef)(null);function S(){var e=/\n/g;return h+"\n    "+x.current.getData().replace(e,"\n    ")+"\nspec:\n    userconfigs:\n        "+k.current.getData().replace(e,"\n        ")+"\n    workloads:\n        "+Z.current.getData().replace(e,"\n        ")+"\n    dependencies:\n        "+N.current.getData().replace(e,"\n        ")+"\n    exports:\n        "+C.current.getData().replace(e,"\n        ")}(0,i.useEffect)((function(){E.current.innerText=h,x.current.setData('name: example\nversion: 0.0.1\ndescription: 样例应用\nkeywords:\n    - 样例应用\nauthor: example@example.com\nmaintainers:\n    - email: example@example.com\n      name: example\n      web: https://example.com\nrepositories: ["https://github.com/example/example.git"]\nbugs: https://github.com/example/example/issues\nlicenses:\n    - type: LGPL\n      url: https://license.spec.com'),k.current.setData('"$schema": http://json-schema.org/draft-07/schema#\n"$id": http://example.com/product.schema.json\ntitle: User\ndescription: init user description\ntype: object\nproperties:\n    username:\n        type: string\n    password:\n        type: string\nrequired:\n    - username\n    - password'),Z.current.setData('- name: example\n  type: webservice\n  vendor: webservice\n  properties:\n      image: nginx:1.21\n  traits:\n      - type: ingress\n        properties:\n            k1: "v1"'),N.current.setData('- name: gitlab\n  version: ">=0.0.1"\n  location: user-defined(https://gitlab.com)\n  items:\n      /*:\n          - create\n          - read\n          - update\n          - delete'),C.current.setData("/user:\n    - create\n    - read\n    - update\n    - delete\n/admin:\n    - create\n    - read\n    - update\n    - delete")}),[]);var w=function(){return""===x.current.getData().trim()?(o.Z.dispatch({type:p.Sn,val:"metadata不能为空"}),!1):""!==Z.current.getData().trim()||(o.Z.dispatch({type:p.Sn,val:"workloads不能为空"}),!1)},j=function(){l(!1)};return i.createElement("section",{className:"page-container online-container"},i.createElement("header",{className:"online-header"},i.createElement("div",{className:"header-logo"},"Crab")),i.createElement("div",{className:"online-content"},i.createElement("div",{className:"oltitle"},"创建应用"),i.createElement("section",{className:"createapp-content"},i.createElement("div",{className:"view-text",ref:E}),i.createElement(f.Z,{ref:x,class:"textarea-edit indent4"}),i.createElement("div",{className:"view-text"},"spec:"),i.createElement("div",{className:"view-text indent4"},"userconfigs:"),i.createElement(f.Z,{ref:k,class:"textarea-edit indent8"}),i.createElement("div",{className:"view-text indent4"},"workloads:"),i.createElement(f.Z,{ref:Z,class:"textarea-edit indent8"}),i.createElement("div",{className:"view-text indent4"},"dependencies:"),i.createElement(f.Z,{ref:N,class:"textarea-edit indent8"}),i.createElement("div",{className:"view-text indent4"},"exports:"),i.createElement(f.Z,{ref:C,class:"textarea-edit indent8"}),i.createElement("div",{className:"online-btns"},i.createElement(s.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){w()&&(o.Z.dispatch({type:p.br,val:!0}),r()({method:"POST",url:"/api/online/download",data:{yaml:S()},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?window.open(window.location.origin+e.data.result):o.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:p.br,val:!1})})))}},"下载"),i.createElement(s.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){w()&&(o.Z.dispatch({type:p.br,val:!0}),r()({method:"POST",url:"/api/online/arrange",data:{yaml:S()},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?(l(!0),b(e.data.result||""),o.Z.dispatch({type:p.Sn,val:"添加应用成功"})):o.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:p.br,val:!1})})))}},"部署")))),i.createElement(u.Z,{open:c,title:"配置实例",data:g,close:j,submit:function(e){if(e.notHadServe.length)o.Z.dispatch({type:p.Sn,val:e.notHadServe.join("、")+"以上应用中不存在服务，请创建"});else if(e.allAppSelectServe.length)o.Z.dispatch({type:p.Sn,val:e.allAppSelectServe.join("、")+"以上应用未选择服务，请选择"});else{o.Z.dispatch({type:p.br,val:!0});var t=function(e){var t=[],n={};return e&&e.dependencies&&Object.keys(e.dependencies).forEach((function(n){e.dependencies[n].location.selected?t.push({name:n,location:e.dependencies[n].location.location}):e.dependencies[n].instances.forEach((function(e){e.selected&&t.push({name:e.instance.name,id:e.instance.id})}))})),e.userconfigs&&function e(t,n,a){t&&("object"==t.type&&t.properties?(a[n]={},Object.keys(t.properties).forEach((function(i){e(t.properties[i],i,a[n])}))):a[n]=t.val)}(e.userconfigs,"userconfigs",n),{id:e.id,dependencies:t,userconfigs:n.userconfigs||null}}(e.appInfo);t.status=1,r()({method:"POST",url:"/api/app/run",headers:{"Content-Type":"application/json"},data:t}).then((function(e){0===e.data.code&&(o.Z.dispatch({type:p.Sn,val:"部署完成"}),j(),setTimeout((function(){window.opener.postMessage("createapp",window.location.origin),window.close()}),1e3)),o.Z.dispatch({type:p.Sn,val:e.data.result||""}),o.Z.dispatch({type:p.br,val:!1})})).catch((function(e){o.Z.dispatch({type:p.Sn,val:"请求错误"}),o.Z.dispatch({type:p.br,val:!1})}))}}}),i.createElement(d.Z,null),i.createElement(m.Z,null))}))}}]);