"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[513],{2225:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(8390),c=n(7294),i=n(8623),s=n(4313),l=n(9525),r=n(6856),o=n(282);const p=function(e){var t=(0,c.useState)(!1),n=(0,a.Z)(t,2),p=n[0],u=n[1],d=(0,c.useState)([]),m=(0,a.Z)(d,2),f=m[0],h=m[1],v=(0,c.useState)(),y=(0,a.Z)(v,2),g=y[0],b=y[1];(0,c.useEffect)((function(){S(e.data)}),[e.data]);var E,N,Z,k,S=function(e){if(e&&e.dependencies&&(Object.keys(e.dependencies).forEach((function(t){var n=[];e.dependencies[t].instances.forEach((function(a,c){0==c&&"mutable"===e.dependencies[t].type?n.push({instance:a,selected:!0}):n.push({instance:a,selected:!1})})),e.dependencies[t].instances&&e.dependencies[t].instances.length&&"immutable"!==e.dependencies[t].type?e.dependencies[t].location={location:e.dependencies[t].location,selected:!1}:e.dependencies[t].location={location:e.dependencies[t].location,selected:!0},e.dependencies[t].instances=n})),console.log("data===",e),b(e),e.userconfigs&&Object.keys(e.userconfigs).length)){var t=[];!function e(n,a,c,i){n&&("object"==n.type&&n.properties?("userconfigs"!==a&&t.push({key:a,type:n.type,val:"",required:!1,error:"",level:i}),i+=1,Object.keys(n.properties).forEach((function(t){e(n.properties[t],t,n.required,i)}))):t.push({key:a,type:n.type,val:"",required:!!c&&-1!==c.indexOf(a),error:"",level:i}))}(e.userconfigs,"userconfigs",!1,-1),u(!0),h(t)}};function x(){e.close()}function w(e,t,n){if("immutable"!==g.dependencies[t].type||"instance"!=e){var a=Object.assign({},g);"instance"===e?(a.dependencies[t].location.selected=!1,a.dependencies[t].instances.forEach((function(e,t){t==n?(e.selected=!e.selected,e.selected):e.selected=!1}))):"location"===e&&(a.dependencies[t].instances.forEach((function(e,t){e.selected=!1})),a.dependencies[t].location.selected=!a.dependencies[t].location.selected,a.dependencies[t].location.selected),b(a)}}function j(){var e=event.target.dataset.key,t=Object.assign({},g);t.dependencies[e].location.location=event.target.value,b(t)}function C(){var e=event.target.dataset.index,t=f.slice();t[e].val=event.target.value,t[e].error="",h(t)}return c.createElement(i.Z,{open:e.open,onClose:x,"aria-labelledby":"upload-file-title"},c.createElement(s.Z,{id:"upload-file-title"},e.title),c.createElement(l.Z,null,c.createElement("div",{className:"instance-content"},(E=e.data,Z=[],k=-34,(N=E.dependencies||null)&&(k+=34,Object.keys(N).forEach((function(e,t){Z.push(c.createElement("div",{style:{paddingLeft:k+"px"},className:"app-item",key:t},c.createElement("div",{className:"app-label"},c.createElement("span",{style:{backgroundColor:"#54CACB"},className:"label-icon app-icon"},c.createElement("i",{className:"iconfont icon_grey600"})," "),c.createElement("span",{className:"label-name"},e)),(N[e].instances||[]).map((function(t,n){return c.createElement("div",{key:n,className:"app-item-versions"},c.createElement("div",{className:"app-label",key:n},c.createElement("span",{className:"label-icon version-icon",onClick:function(){w("instance",e,n)}},c.createElement("i",{style:{color:"mutable"===N[e].type?"#54CACB":"#e0e0e0"},className:"".concat(t.selected?"iconfont icon_d-pass":"")})),c.createElement("span",{className:"label-name",style:{color:"mutable"===N[e].type?"#262626":"gray"}},"实例：",t.instance&&t.instance.id?t.instance.id:"","  ",t.instance&&t.instance.name?t.instance.name:"")))})),N[e].location?c.createElement("div",{className:"app-item-versions"},c.createElement("div",{className:"app-label"},c.createElement("span",{className:"label-icon version-icon",onClick:function(){w("location",e,"")}},c.createElement("i",{style:{color:"mutable"===N[e].type?"#54CACB":"#e0e0e0"},className:"".concat(N[e].location.selected?"iconfont icon_d-pass":"")})),c.createElement("span",{className:"label-name",style:{color:"mutable"===N[e].type?"#262626":"gray"}},"服务地址：",c.createElement("input",{"data-key":e,onChange:j,value:N[e].location.location,disabled:"immutable"===N[e].type,style:{color:"mutable"===N[e].type?"#262626":"gray"}})))):null,N[e].instances.length||N[e].location?null:c.createElement("div",{className:"app-item-versions"},c.createElement("div",{className:"app-label"},c.createElement("span",{className:"label-icon version-icon"}),c.createElement("span",{className:"label-name"},"暂无，需创建")))))}))),Z).map((function(e,t){return e}))),c.createElement(i.Z,{open:p,"aria-labelledby":"config-title"},c.createElement(s.Z,{id:"config-title"},"实例配置"),c.createElement(l.Z,null,c.createElement("div",{className:"appconfig-content"},f.map((function(e,t){return"object"===e.type?c.createElement("div",{key:e.key,className:"config-item",style:{marginLeft:40*e.level+"px"}},c.createElement("div",{className:"item-input"},c.createElement("label",null,e.key,":"))):c.createElement("div",{key:e.key,className:"config-item",style:{marginLeft:40*e.level+"px"}},c.createElement("div",{className:"item-input"},c.createElement("label",null,e.required?c.createElement("span",null,"* "):null,e.key,":"),c.createElement("input",{type:"number"==e.type?"number":"text",className:e.error?"red-border":"",placeholder:"number"===e.type?"请输入number类型":"请输入string类型","data-index":t,onChange:C,value:e.val})),e.error?c.createElement("p",{className:"item-error"},e.error):null)})))),c.createElement(r.Z,null,c.createElement(o.Z,{className:"common-btn",color:"primary",onClick:function(){var e=!0,t=f.slice();if(t.forEach((function(t){"object"!==t.type&&t.required&&""==t.val.trim()&&(t.error="请输入",e=!1)})),e){var n=Object.assign({},g);!function e(t,n){if(t)if("object"==t.type&&t.properties)Object.keys(t.properties).forEach((function(n){e(t.properties[n],n)}));else{console.log(222);var a=f.findIndex((function(e){return e.key===n}));t.val="number"===f[a].type?Number(f[a].val):f[a].val}}(n.userconfigs,"userconfigs"),console.log("--newAppInfo--",n),b(n),u(!1)}else h(t)}},"确定")))),c.createElement(r.Z,null,c.createElement(o.Z,{className:"common-btn",onClick:x},"取消"),c.createElement(o.Z,{className:"common-btn",color:"primary",onClick:function(){var t,n,a,c;e.submit((t=function(e){var t,n=[];return t=e,Object.keys(t).length&&Object.keys(t).forEach((function(e){var a=!1;t[e].location.selected?a=!0:t[e].instances.forEach((function(e){e.selected&&(a=!0)})),a||n.push(e)})),n}(g.dependencies||{}),console.log("--getData-0",g),{appInfo:g,notHadServe:(n=g.dependencies||[],c=[],a=n,Object.keys(a).length&&Object.keys(a).forEach((function(e){a[e].instances.length||a[e].location||c.push(e)})),c||[]),allAppSelectServe:t}))}},"确定")))}},5597:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(5671),c=n(3144),i=n(7326),s=n(136),l=n(2963),r=n(1120),o=n(7294),p=n(4981);n(2477),n(6588);var u=function(e){(0,s.Z)(d,e);var t,n,u=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,r.Z)(t);if(n){var c=(0,r.Z)(this).constructor;e=Reflect.construct(a,arguments,c)}else e=a.apply(this,arguments);return(0,l.Z)(this,e)});function d(e){var t;return(0,a.Z)(this,d),(t=u.call(this,e)).state={value:"",height:19,cursorStyle:"ace-cursor"},t.change=t.change.bind((0,i.Z)(t)),t.focus=t.focus.bind((0,i.Z)(t)),t.blur=t.blur.bind((0,i.Z)(t)),t.lineHeight=0,t.propsHeight=19,t}return(0,c.Z)(d,[{key:"focus",value:function(){this.setState({cursorStyle:""})}},{key:"blur",value:function(){this.setState({cursorStyle:"ace-cursor"})}},{key:"change",value:function(e){var t=this;this.setState({value:e},(function(){t.resize()}))}},{key:"getData",value:function(){return this.state.value}},{key:"setData",value:function(e){var t=this;this.setState({value:e},(function(){t.resize()}))}},{key:"setHeight",value:function(e){this.propsHeight=e,this.setState({height:e})}},{key:"resize",value:function(){this.lineHeight||(this.lineHeight=parseInt(getComputedStyle(document.querySelector(".ace_line")).lineHeight.replace("px","")));var e=this.state.value.split("\n").length;e*this.lineHeight>this.propsHeight?this.setState({height:e*this.lineHeight}):this.setState({height:this.propsHeight})}},{key:"aceLoaded",value:function(e){e.renderer.setPadding(0)}},{key:"render",value:function(){return o.createElement(p.ZP,{mode:"yaml",theme:"xcode",width:"100%",height:this.state.height+"px",style:{margin:0},placeholder:"请输入...",fontSize:14,tabSize:2,value:this.state.value,onLoad:this.aceLoaded,onChange:this.change,name:this.props.uniqueName,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1,onFocus:this.focus,onBlur:this.blur,editorProps:{$blockScrolling:!0}})}}]),d}(o.Component)},7513:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a=n(8390),c=n(7294),i=n(4494),s=n(282),l=n(9669),r=n.n(l),o=n(3411),p=n(5347),u=n(2225),d=n(9678),m=n(6105),f=n(5597),h="apiVersion: aam.globalsphare.com/v1alpha1\nkind: Application\nmetadata:";const v=(0,i.$j)((function(e){return e}))((function(e){var t=(0,c.useState)(!1),n=(0,a.Z)(t,2),i=n[0],l=n[1],v=(0,c.useState)({}),y=(0,a.Z)(v,2),g=y[0],b=y[1],E=(0,c.useRef)(null),N=(0,c.useRef)(null),Z=(0,c.useRef)(null),k=(0,c.useRef)(null),S=(0,c.useRef)(null),x=(0,c.useRef)(null);function w(){var e=/\n/g;return h+"\n  "+N.current.getData().replace(e,"\n  ")+"\nspec:\n  userconfigs:\n    "+Z.current.getData().replace(e,"\n    ")+"\n  workloads:\n    "+k.current.getData().replace(e,"\n    ")+"\n  dependencies:\n    "+S.current.getData().replace(e,"\n    ")+"\n  exports:\n    "+x.current.getData().replace(e,"\n    ")}(0,c.useEffect)((function(){E.current.innerText=h,N.current.setData('name: example\nversion: 0.0.1\ndescription: 样例应用\nkeywords:\n  - 样例应用\nauthor: example@example.com\nmaintainers:\n  - email: example@example.com\n    name: example\n    web: https://example.com\nrepositories: ["https://github.com/example/example.git"]\nbugs: https://github.com/example/example/issues\nlicenses:\n  - type: LGPL\n    url: https://license.spec.com'),Z.current.setData('"$schema": http://json-schema.org/draft-07/schema#\n"$id": http://example.com/product.schema.json\ntitle: User\ndescription: init user description\ntype: object\nproperties:\n  username:\n    type: string\n  password:\n    type: string\nrequired:\n  - username\n  - password'),k.current.setData('- name: example\n  type: webservice\n  vendor: webservice\n  properties:\n    image: nginx:1.21\n  traits:\n    - type: ingress\n      properties:\n        k1: "v1"'),S.current.setData('- name: gitlab\n  version: ">=0.0.1"\n  location: user-defined(https://gitlab.com)\n  items:\n    /*:\n      - create\n      - read\n      - update\n      - delete'),x.current.setData("/user:\n  - create\n  - read\n  - update\n  - delete\n/admin:\n  - create\n  - read\n  - update\n  - delete")}),[]);var j=function(){return""===N.current.getData().trim()?(o.Z.dispatch({type:p.Sn,val:"metadata不能为空"}),!1):""!==k.current.getData().trim()||(o.Z.dispatch({type:p.Sn,val:"workloads不能为空"}),!1)},C=function(){l(!1)};return c.createElement("section",{className:"page-container online-container"},c.createElement("header",{className:"online-header"},c.createElement("div",{className:"header-logo"},"Crab")),c.createElement("div",{className:"online-content"},c.createElement("div",{className:"oltitle"},"创建应用"),c.createElement("section",{className:"createapp-content"},c.createElement("div",{className:"view-text",ref:E}),c.createElement("div",{className:"textarea-edit indent4"},c.createElement(f.Z,{ref:N,uniqueName:"metaDataRef"})),c.createElement("div",{className:"view-text"},"spec:"),c.createElement("div",{className:"view-text indent6"},"userconfigs:"),c.createElement("div",{className:"textarea-edit indent8"},c.createElement(f.Z,{ref:Z,uniqueName:"userConfigsRef"})),c.createElement("div",{className:"view-text indent6"},"workloads:"),c.createElement("div",{className:"textarea-edit indent8"},c.createElement(f.Z,{ref:k,uniqueName:"workloadsRef"})),c.createElement("div",{className:"view-text indent6"},"dependencies:"),c.createElement("div",{className:"textarea-edit indent8"},c.createElement(f.Z,{ref:S,uniqueName:"dependenciesRef"})),c.createElement("div",{className:"view-text indent6"},"exports:"),c.createElement("div",{className:"textarea-edit indent8"},c.createElement(f.Z,{ref:x,uniqueName:"exportsRef"})),c.createElement("div",{className:"online-btns"},c.createElement(s.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){j()&&(o.Z.dispatch({type:p.br,val:!0}),r()({method:"POST",url:"/api/online/download",data:{yaml:w()},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?window.open(window.location.origin+e.data.result):o.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:p.br,val:!1})})))}},"下载"),c.createElement(s.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){j()&&(o.Z.dispatch({type:p.br,val:!0}),r()({method:"POST",url:"/api/online/arrange",data:{yaml:w()},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?(l(!0),b(e.data.result||""),o.Z.dispatch({type:p.Sn,val:"添加应用成功"})):o.Z.dispatch({type:p.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:p.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:p.br,val:!1})})))}},"部署")))),c.createElement(u.Z,{open:i,title:"配置实例",data:g,close:C,submit:function(e){if(e.notHadServe.length)o.Z.dispatch({type:p.Sn,val:e.notHadServe.join("、")+"以上应用中不存在服务，请创建"});else if(e.allAppSelectServe.length)o.Z.dispatch({type:p.Sn,val:e.allAppSelectServe.join("、")+"以上应用未选择服务，请选择"});else{o.Z.dispatch({type:p.br,val:!0});var t=function(e){var t=[],n={};return e&&e.dependencies&&Object.keys(e.dependencies).forEach((function(n){e.dependencies[n].location.selected?t.push({name:n,location:e.dependencies[n].location.location}):e.dependencies[n].instances.forEach((function(e){e.selected&&t.push({name:e.instance.name,id:e.instance.id})}))})),e.userconfigs&&function e(t,n,a){t&&("object"==t.type&&t.properties?(a[n]={},Object.keys(t.properties).forEach((function(c){e(t.properties[c],c,a[n])}))):a[n]=t.val)}(e.userconfigs,"userconfigs",n),{id:e.id,dependencies:t,userconfigs:n.userconfigs||null}}(e.appInfo);t.status=1,r()({method:"POST",url:"/api/app/run",headers:{"Content-Type":"application/json"},data:t}).then((function(e){0===e.data.code&&(o.Z.dispatch({type:p.Sn,val:"部署完成"}),C(),setTimeout((function(){window.opener.postMessage("createapp",window.location.origin),window.close()}),1e3)),o.Z.dispatch({type:p.Sn,val:e.data.result||""}),o.Z.dispatch({type:p.br,val:!1})})).catch((function(e){o.Z.dispatch({type:p.Sn,val:"请求错误"}),o.Z.dispatch({type:p.br,val:!1})}))}}}),c.createElement(d.Z,null),c.createElement(m.Z,null))}))}}]);