"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[923,444],{6381:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(5671),r=n(3144),i=n(7326),c=n(9611),o=n(1002);function l(e,t){return!t||"object"!==(0,o.Z)(t)&&"function"!=typeof t?(0,i.Z)(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=n(7294);var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,c.Z)(e,t)}(p,e);var t,n,o=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return l(this,e)});function p(e){var t;return(0,a.Z)(this,p),(t=o.call(this,e)).state={value:""},t.txaRef=u.createRef(),t.setData=t.setData.bind((0,i.Z)(t)),t.getData=t.getData.bind((0,i.Z)(t)),t.lineHeight=0,t.padding=0,t}return(0,r.Z)(p,[{key:"componentDidMount",value:function(){this.lineHeight=parseInt(getComputedStyle(this.txaRef.current).lineHeight),this.padding=2*parseInt(getComputedStyle(this.txaRef.current).paddingTop),this.txaRef.current.style.height=this.padding+this.lineHeight+"px"}},{key:"setData",value:function(e){var t=this;this.setState({value:e},(function(){""===t.state.value.trim()?t.txaRef.current.style.height=t.padding+t.lineHeight+"px":t.txaRef.current.style.height=t.txaRef.current.scrollHeight+"px"}))}},{key:"getData",value:function(){return this.state.value}},{key:"changeValue",value:function(e){this.setState({value:e.target.value})}},{key:"keyDown",value:function(e){13===e.keyCode&&(this.txaRef.current.style.height=this.txaRef.current.offsetHeight+this.lineHeight+"px")}},{key:"keyUp",value:function(e){8===e.keyCode&&e.target.value.split("\n").length*this.lineHeight+this.padding<this.txaRef.current.offsetHeight&&(this.txaRef.current.style.height=this.txaRef.current.offsetHeight-this.lineHeight+"px")}},{key:"autoTxaClick",value:function(){this.txaRef.current.focus()}},{key:"paste",value:function(){console.log("---paste"),this.txaRef.current.style.height=this.txaRef.current.scrollHeight+"px"}},{key:"render",value:function(){return u.createElement("div",{className:"auto-textarea ".concat(this.props.class),onClick:this.autoTxaClick.bind(this)},u.createElement("textarea",{ref:this.txaRef,className:"auto-input",placeholder:"请输入...",value:this.state.value,onChange:this.changeValue.bind(this),onKeyDown:this.keyDown.bind(this),onKeyUp:this.keyUp.bind(this),onPaste:this.paste.bind(this)}))}}]),p}(u.Component)},9678:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),r=n(3411),i=n(4494),c=n(5477);const o=(0,i.$j)((function(e){return e}))((function(e){var t=r.Z.getState().common.loading;return a.createElement("div",{className:" circular-progress ".concat(t?"show-progress":"")},a.createElement(c.Z,{size:60,color:"primary"}))}))},6105:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(7462),r=n(7294),i=n(6912),c=n(2285),o=n(3411),l=n(5347),s=n(4494),u=function(e){return r.createElement(c.Z,(0,a.Z)({},e,{direction:"up"}))};const p=(0,s.$j)((function(e){return e}))((function(e){return r.createElement("div",{className:"snackbar-container"},r.createElement(i.Z,{open:Boolean(o.Z.getState().common.snackbar),anchorOrigin:{vertical:"bottom",horizontal:"center"},autoHideDuration:5e3,onClose:function(){o.Z.dispatch({type:l.Sn,val:""})},TransitionComponent:u,message:o.Z.getState().common.snackbar}))}))},5923:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var a=n(8390),r=n(7294),i=n(4494),c=n(282),o=n(9669),l=n.n(o),s=n(3411),u=n(5347),p=n(9678),d=n(6105),h=n(6381),f="apiVersion: aam.globalsphare.com/v1alpha1\nkind: WorkloadVendor\nmetadata:";const m=(0,i.$j)((function(e){return e}))((function(e){var t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(null),m=(0,r.useRef)(null),v=(0,r.useState)(!1),y=(0,a.Z)(v,2),g=y[0],Z=y[1],b=(0,r.useState)(""),x=(0,a.Z)(b,2),E=x[0],k=x[1],S=(0,r.useState)(null),w=(0,a.Z)(S,2),D=w[0],R=w[1],N=(0,r.useState)(!1),C=(0,a.Z)(N,2),T=C[0],H=C[1];(0,r.useEffect)((function(){var e=function(){var e="";if(window.location.search){var t=window.location.search.substring(1);if(t.indexOf("&"))for(var n=t.split("&"),a=0,r=n.length;a<r;a++){var i=n[a].split("=");if(i&&"name"===i[0]){e=i[1];break}}}return e}();n.current.innerText=f,t.current.setData("name: example"),e?(k(e),O(e)):m.current.setData("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: nginx-deployment\n    labels:\n        app: nginx\nspec:\n    replicas: 3\n    selector:\n        matchLabels:\n            app: nginx\n    template:\n        metadata:\n            labels:\n                app: nginx\n    spec:\n        containers:\n          - name: nginx\n            image: nginx:1.14.2\n            ports:\n                - containerPort: 80")}),[]);var O=function(e){s.Z.dispatch({type:u.br,val:!0}),l()({method:"GET",url:"/api/online/getworkloadvendor",params:{name:e}}).then((function(e){0==e.data.code?(R(e.data.result||{}),m.current.setData(e.data.result.yaml||""),o.current.setData(e.data.result.cue||"")):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))};function _(){var e=/\n/g;return f+"\n    "+t.current.getData().replace(e,"\n    ")+"\nspec: | \n    "+i.current.getData().replace(e,"\n    ")+"\n    "+o.current.getData().replace(e,"\n        ")}return(0,r.useEffect)((function(){l()({method:"GET",url:"/api/online/systemspec"}).then((function(e){0==e.data.code?i.current.setData(e.data.result||""):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})}))}),[]),r.createElement("section",{className:"page-container online-container"},r.createElement("header",{className:"online-header"},r.createElement("div",{className:"header-logo"},"Crab")),r.createElement("div",{className:"online-content"},r.createElement("div",{className:"oltitle"},"创建WorkloadType"),r.createElement("section",{className:"vendor-content"},r.createElement("div",{className:"vendor-left"},r.createElement("div",{className:"online-title"},r.createElement("p",null,"yaml")),r.createElement(h.Z,{ref:m,class:"yaml-textarea"}),r.createElement("div",{className:"online-btns"},r.createElement(c.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=m.current.getData();""!==e.trim()?(s.Z.dispatch({type:u.br,val:!0}),l()({method:"POST",url:"/api/online/translateyaml",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?(o.current.setData(e.data.result||""),s.Z.dispatch({type:u.Sn,val:"转换完成"})):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))):s.Z.dispatch({type:u.Sn,val:"请填写yaml"})}},"转换yaml为cue"))),r.createElement("div",{className:"vendor-right"},r.createElement("div",{className:"view-text",ref:n}),r.createElement(h.Z,{ref:t,class:"textarea-edit indent4"}),r.createElement("div",{className:"view-text"},"spec: |",r.createElement("button",{className:"fold-btn",onClick:function(){Z(!g)}},r.createElement("span",{className:"iconfont ".concat(g?"icon_navigation_combobox_down":"icon_navigation_combobox_up")}))),r.createElement(h.Z,{ref:i,class:"textarea-edit indent4  ".concat(g?"hide-textarea":"")}),r.createElement("div",{className:"view-text"},"cue Template:"),r.createElement(h.Z,{ref:o,class:"textarea-edit indent4"}),r.createElement("div",{className:"online-btns"},r.createElement(c.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=o.current.getData();""!==e.trim()?(s.Z.dispatch({type:u.br,val:!0}),l()({method:"POST",url:"/api/online/checkcue",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){s.Z.dispatch({type:u.Sn,val:0===e.data.code?"检查正确":e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))):s.Z.dispatch({type:u.Sn,val:"cue 不能为空"})}},"检查")),r.createElement("div",{className:"online-btns"},E?r.createElement(c.Z,{disabled:T,className:"online-btn",variant:"contained",color:"primary",onClick:function(){s.Z.dispatch({type:u.br,val:!0});var e="/api/cluster/editvendor?id=".concat(D.id||"");H(!0),l()({url:e,method:"POST",headers:{"Content-Type":"application/json"},data:{metadata:t.current.getData(),yaml:m.current.getData(),cue:o.current.getData(),value:_()}}).then((function(e){0==e.data.code?setTimeout((function(){H(!1),window.opener.postMessage("workloadtype",window.location.origin),window.close()}),1e3):H(!1),s.Z.dispatch({type:u.Sn,val:e.data.result||""})})).catch((function(e){console.error(e),H(!1),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))}},"修改"):r.createElement(c.Z,{disabled:T,className:"online-btn",variant:"contained",color:"primary",onClick:function(){(""===t.current.getData().trim()?(s.Z.dispatch({type:u.Sn,val:"metadata 不能为空"}),0):""===i.current.getData().trim()?(s.Z.dispatch({type:u.Sn,val:"spec 不能为空"}),0):""!==o.current.getData().trim()||(s.Z.dispatch({type:u.Sn,val:"cue 不能为空"}),0))&&(s.Z.dispatch({type:u.br,val:!0}),H(!0),l()({method:"POST",url:"/api/online/createvendor",data:{metadata:t.current.getData(),yaml:m.current.getData(),cue:o.current.getData(),value:_()},headers:{"Content-Type":"application/json"}}).then((function(e){s.Z.dispatch({type:u.Sn,val:e.data.result}),0==e.data.code?setTimeout((function(){H(!1),window.opener.postMessage("workloadvendor",window.location.origin),window.close()}),1e3):H(!1)})).catch((function(e){console.log(e),H(!1),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})})))}},"保存"))))),r.createElement(p.Z,null),r.createElement(d.Z,null))}))},5671:(e,t,n)=>{function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:()=>a})}}]);