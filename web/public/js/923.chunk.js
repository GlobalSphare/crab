"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[923],{6031:(e,t,a)=>{a(5671),a(3144),a(7326),a(136),a(2963),a(1120);a(7294).Component},5597:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(5671),i=a(3144),r=a(7326),l=a(136),c=a(2963),o=a(1120),s=a(7294),u=a(4981);a(2477),a(6588);var d=function(e){(0,l.Z)(p,e);var t,a,d=(t=p,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,o.Z)(t);if(a){var i=(0,o.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,c.Z)(this,e)});function p(e){var t;return(0,n.Z)(this,p),(t=d.call(this,e)).state={value:"",height:19,cursorStyle:"ace-cursor"},t.change=t.change.bind((0,r.Z)(t)),t.focus=t.focus.bind((0,r.Z)(t)),t.blur=t.blur.bind((0,r.Z)(t)),t.lineHeight=0,t.propsHeight=19,t}return(0,i.Z)(p,[{key:"focus",value:function(){this.setState({cursorStyle:""})}},{key:"blur",value:function(){this.setState({cursorStyle:"ace-cursor"})}},{key:"change",value:function(e){var t=this;this.setState({value:e},(function(){t.resize()}))}},{key:"getData",value:function(){return this.state.value}},{key:"setData",value:function(e){var t=this;this.setState({value:e},(function(){t.resize()}))}},{key:"setHeight",value:function(e){this.propsHeight=e,this.setState({height:e})}},{key:"resize",value:function(){this.lineHeight||(this.lineHeight=parseInt(getComputedStyle(document.querySelector(".ace_line")).lineHeight.replace("px","")));var e=this.state.value.split("\n").length;e*this.lineHeight>this.propsHeight?this.setState({height:e*this.lineHeight}):this.setState({height:this.propsHeight})}},{key:"aceLoaded",value:function(e){e.renderer.setPadding(0)}},{key:"render",value:function(){return s.createElement(u.ZP,{mode:"yaml",theme:"xcode",width:"100%",height:this.state.height+"px",style:{margin:0},placeholder:"请输入...",fontSize:14,tabSize:2,value:this.state.value,onLoad:this.aceLoaded,onChange:this.change,name:this.props.uniqueName,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1,onFocus:this.focus,onBlur:this.blur,editorProps:{$blockScrolling:!0}})}}]),p}(s.Component)},5923:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(8390),i=a(7294),r=a(4494),l=a(282),c=a(9669),o=a.n(c),s=a(3411),u=a(5347),d=a(9678),p=a(6105),h=(a(6031),a(5597)),m="kind: WorkloadVendor\nmetadata:";const v=(0,r.$j)((function(e){return e}))((function(e){var t=(0,i.useRef)(null),a=(0,i.useRef)(null),r=(0,i.useRef)(null),c=(0,i.useRef)(null),v=((0,i.useRef)(null),(0,i.useRef)(null)),f=(0,i.useRef)(null),y=(0,i.useState)(""),g=(0,n.Z)(y,2),Z=g[0],b=g[1],S=(0,i.useState)(!0),E=(0,n.Z)(S,2),N=E[0],k=E[1],w=(0,i.useState)(""),D=(0,n.Z)(w,2),x=D[0],C=D[1],R=(0,i.useState)(null),T=(0,n.Z)(R,2),H=T[0],_=T[1],P=(0,i.useState)(!1),V=(0,n.Z)(P,2),q=V[0],L=V[1];(0,i.useEffect)((function(){var e=function(){var e="";if(window.location.search){var t=window.location.search.substring(1);if(t.indexOf("&"))for(var a=t.split("&"),n=0,i=a.length;n<i;n++){var r=a[n].split("=");if(r&&"name"===r[0]){e=r[1];break}}}return e}();c.current.innerText=m,e?(C(e),O(e)):(a.current.setData("apiVersion: aam.globalsphare.com/v1alpha1"),f.current.setData("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:1.14.2\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\nspec:\n  selector:\n    app: nginx\n  ports:\n    - port: 80\n      name: http"),r.current.setData("name: example"))}),[]);var O=function(e){s.Z.dispatch({type:u.br,val:!0}),o()({method:"GET",url:"/api/online/getworkloadvendor",params:{name:e}}).then((function(e){0==e.data.code?(_(e.data.result||{}),a.current.setData("apiVersion: "+(e.data.result.apiVersion||"")),r.current.setData(e.data.result.metadata||""),f.current.setData(e.data.result.yaml||""),v.current.setData(e.data.result.cue||"")):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))};function j(){var e=/\n/g;return a.current.getData()+"\n"+m+"\n  "+r.current.getData().replace(e,"\n  ")+"\nspec: | \n  "+Z.replace(e,"\n  ")+"\n  "+v.current.getData().replace(e,"\n    ")}return(0,i.useEffect)((function(){o()({method:"GET",url:"/api/online/systemspec"}).then((function(e){0==e.data.code?(b(e.data.result||""),t.current.innerText=e.data.result||""):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})}))}),[]),i.createElement("section",{className:"page-container online-container"},i.createElement("header",{className:"online-header"},i.createElement("div",{className:"header-logo"},"Crab")),i.createElement("div",{className:"online-content"},i.createElement("div",{className:"oltitle"},x?"修改":"创建"," WorkloadVendor ",x?" : "+x:""),i.createElement("section",{className:"vendor-content"},i.createElement("div",{className:"vendor-left"},i.createElement("div",{className:"online-title"},i.createElement("p",null,"K8s YAML")),i.createElement("div",{className:"yaml-textarea"},i.createElement(h.Z,{ref:f,uniqueName:"yamlRef"})),i.createElement("div",{className:"online-btns"},i.createElement(l.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=f.current.getData();""!==e.trim()?(s.Z.dispatch({type:u.br,val:!0}),o()({method:"POST",url:"/api/online/translateyaml",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?(v.current.setData(e.data.result||""),s.Z.dispatch({type:u.Sn,val:"转换完成"})):s.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))):s.Z.dispatch({type:u.Sn,val:"请填写yaml"})}},"转换yaml为cue"))),i.createElement("div",{className:"vendor-right"},i.createElement("div",{className:"online-title titlepadding"},i.createElement("p",null,"WorkloadVendor")),i.createElement("div",{className:"textarea-edit"},i.createElement(h.Z,{ref:a,uniqueName:"headerRef"})),i.createElement("div",{className:"view-text",ref:c}),i.createElement("div",{className:"textarea-edit indent4"},i.createElement(h.Z,{ref:r,uniqueName:"metaDataRef"})),i.createElement("div",{className:"view-text"},"spec: |",i.createElement("button",{className:"fold-btn",onClick:function(){k(!N)}},i.createElement("span",{className:"iconfont ".concat(N?"icon_navigation_combobox_down":"icon_navigation_combobox_up")}))),i.createElement("div",{className:"vendor-preview indent6 ".concat(N?"hide-textarea":"")},i.createElement("pre",{className:"preview-pre",ref:t})),i.createElement("div",{className:"textarea-edit indent4"},i.createElement(h.Z,{ref:v,uniqueName:"metaDataRef"})),i.createElement("div",{className:"online-btns"},i.createElement(l.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=v.current.getData();""!==e.trim()?(s.Z.dispatch({type:u.br,val:!0}),o()({method:"POST",url:"/api/online/checkcue",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){s.Z.dispatch({type:u.Sn,val:0===e.data.code?"检查正确":e.data.result})})).catch((function(e){console.log(e),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))):s.Z.dispatch({type:u.Sn,val:"cue 不能为空"})}},"检查")),i.createElement("div",{className:"online-btns"},x?i.createElement(l.Z,{disabled:q,className:"online-btn",variant:"contained",color:"primary",onClick:function(){s.Z.dispatch({type:u.br,val:!0});var e="/api/cluster/editvendor?id=".concat(H.id||"");L(!0),o()({url:e,method:"POST",headers:{"Content-Type":"application/json"},data:{metadata:r.current.getData(),yaml:f.current.getData(),cue:v.current.getData(),value:j()}}).then((function(e){0==e.data.code?setTimeout((function(){L(!1),window.opener.postMessage("workloadtype",window.location.origin),window.close()}),1e3):L(!1),s.Z.dispatch({type:u.Sn,val:e.data.result||""})})).catch((function(e){console.error(e),L(!1),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})}))}},"确认修改"):i.createElement(l.Z,{disabled:q,className:"online-btn",variant:"contained",color:"primary",onClick:function(){(""===r.current.getData().trim()?(s.Z.dispatch({type:u.Sn,val:"metadata 不能为空"}),0):""!==v.current.getData().trim()||(s.Z.dispatch({type:u.Sn,val:"cue 不能为空"}),0))&&(s.Z.dispatch({type:u.br,val:!0}),L(!0),o()({method:"POST",url:"/api/online/createvendor",data:{metadata:r.current.getData(),yaml:f.current.getData(),cue:v.current.getData(),value:j()},headers:{"Content-Type":"application/json"}}).then((function(e){s.Z.dispatch({type:u.Sn,val:e.data.result}),0==e.data.code?setTimeout((function(){L(!1),window.opener.postMessage("workloadvendor",window.location.origin),window.close()}),1e3):L(!1)})).catch((function(e){console.log(e),L(!1),s.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){s.Z.dispatch({type:u.br,val:!1})})))}},"保存"))))),i.createElement(d.Z,null),i.createElement(p.Z,null))}))}}]);